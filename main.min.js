var VPro=function(){"use strict";const t={};const e=Symbol("solid-track"),n={equals:(t,e)=>t===e};let r=N;const s={},i={owned:null,cleanups:null,context:null,owner:null};var o=null;let l,u=null,a=null,c=null,h=null,f=0;function d(t,e){const n=u,r=o,s=0===t.length?i:{owned:null,cleanups:null,context:null,owner:e||r};o=s,u=null;try{return E((()=>t((()=>L(s)))),!0)}finally{u=n,o=r}}function g(t,e){e=e?Object.assign({},n,e):n;const r={value:t,observers:null,observerSlots:null,pending:s,comparator:e.equals||void 0};return[k.bind(r),t=>("function"==typeof t&&(t=t(r.pending!==s?r.pending:r.value)),A(r,t))]}function v(t,e,n){$(q(t,e,!0,1))}function p(t,e,n){$(q(t,e,!1,1))}function m(t,e,n){r=M;const s=q(t,e,!1,1);s.user=!0,h?h.push(s):$(s)}function _(t,e,r){r=r?Object.assign({},n,r):n;const i=q(t,e,!0,0);return i.pending=s,i.observers=null,i.observerSlots=null,i.comparator=r.equals||void 0,$(i),k.bind(i)}function y(e,n,r){2===arguments.length?"object"==typeof n&&(r=n,n=e,e=!0):1===arguments.length&&(n=e,e=!0),r||(r={});const s=new Set,[i,o]=g(r.initialValue),[a,c]=g(void 0,{equals:!1}),[h,f]=g(!1),[d,p]=g();let m,y=null,x=null,k=null,A=!1,$="initialValue"in r,q="function"==typeof e&&_(e);function S(t,e,n,s){return y===t&&(y=null,$=!0,x&&(t===x||e===x)&&r.onHydrated&&queueMicrotask((()=>r.onHydrated(s,{value:e}))),x=null,p(m=n),E(e)),e}function E(t){w((()=>{o((()=>t)),f(!1);for(const t of s.keys())t.decrement();s.clear()}))}function N(){const t=l,e=i();if(m)throw m;return u&&!u.user&&t&&v((()=>{a(),y&&(t.resolved||s.has(t)||(t.increment(),s.add(t)))})),e}function M(t=!0){if(t&&A)return;A=!1,p(m=void 0);const r=q?q():e;if(null==r||!1===r)return void S(y,b(i));const s=x||b((()=>n(r,{value:i(),refetching:t})));return"object"==typeof s&&"then"in s?(y=s,A=!0,queueMicrotask((()=>A=!1)),w((()=>{f(!0),c()})),s.then((t=>S(s,t,void 0,r)),(t=>S(s,t,t)))):(S(y,s),s)}return t.context&&(k=`${t.context.id}${t.context.count++}`,t.load&&(x=t.load(k))),Object.defineProperties(N,{loading:{get:()=>h()},error:{get:()=>d()},latest:{get(){if(!$)return N();if(m)throw m;return i()}}}),q?v((()=>M(!1))):M(!1),[N,{refetch:M,mutate:o}]}function w(t){if(a)return t();let e;const n=a=[];try{e=t()}finally{a=null}return E((()=>{for(let t=0;t<n.length;t+=1){const e=n[t];if(e.pending!==s){const t=e.pending;e.pending=s,A(e,t)}}}),!1),e}function b(t){let e,n=u;return u=null,e=t(),u=n,e}function x(t,e,n){const r=Array.isArray(t);let s,i=n&&n.defer;return n=>{let o;if(r){o=Array(t.length);for(let e=0;e<t.length;e++)o[e]=t[e]()}else o=t();if(i)return void(i=!1);const l=b((()=>e(o,s,n)));return s=o,l}}function k(){if(this.sources&&this.state){const t=c;c=null,1===this.state?$(this):C(this),c=t}if(u){const t=this.observers?this.observers.length:0;u.sources?(u.sources.push(this),u.sourceSlots.push(t)):(u.sources=[this],u.sourceSlots=[t]),this.observers?(this.observers.push(u),this.observerSlots.push(u.sources.length-1)):(this.observers=[u],this.observerSlots=[u.sources.length-1])}return this.value}function A(t,e,n){if(a)return t.pending===s&&a.push(t),t.pending=e,e;if(t.comparator&&t.comparator(t.value,e))return e;let r=!1;return t.value=e,t.observers&&t.observers.length&&E((()=>{for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];r,n.state||(n.pure?c.push(n):h.push(n),n.observers&&P(n)),n.state=1}if(c.length>1e6)throw c=[],new Error}),!1),e}function $(t){if(!t.fn)return;L(t);const e=o,n=u,r=f;u=o=t,function(t,e,n){let r;try{r=t.fn(e)}catch(t){T(t)}(!t.updatedAt||t.updatedAt<=n)&&(t.observers&&t.observers.length?A(t,r):t.value=r,t.updatedAt=n)}(t,t.value,r),u=n,o=e}function q(t,e,n,r=1,s){const l={fn:t,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:o,context:null,pure:n};return null===o||o!==i&&(o.owned?o.owned.push(l):o.owned=[l]),l}function S(t){if(0===t.state)return;if(2===t.state)return C(t);if(t.suspense&&b(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<f);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(1===(t=e[n]).state)$(t);else if(2===t.state){const n=c;c=null,C(t,e[0]),c=n}}function E(t,e){if(c)return t();let n=!1;e||(c=[]),h?n=!0:h=[],f++;try{const e=t();return function(t){c&&(N(c),c=null);if(t)return;h.length?w((()=>{r(h),h=null})):h=null}(n),e}catch(t){T(t)}finally{c=null,n||(h=null)}}function N(t){for(let e=0;e<t.length;e++)S(t[e])}function M(e){let n,r=0;for(n=0;n<e.length;n++){const t=e[n];t.user?e[r++]=t:S(t)}var s;t.context&&(t.context=s);const i=e.length;for(n=0;n<r;n++)S(e[n]);for(n=i;n<e.length;n++)S(e[n])}function C(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const r=t.sources[n];r.sources&&(1===r.state?r!==e&&S(r):2===r.state&&C(r,e))}}function P(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=2,n.pure?c.push(n):h.push(n),n.observers&&P(n))}}function L(t){let e;if(t.sources)for(;t.sources.length;){const e=t.sources.pop(),n=t.sourceSlots.pop(),r=e.observers;if(r&&r.length){const t=r.pop(),s=e.observerSlots.pop();n<r.length&&(t.sourceSlots[s]=n,r[n]=t,e.observerSlots[n]=s)}}if(t.owned){for(e=0;e<t.owned.length;e++)L(t.owned[e]);t.owned=null}if(t.cleanups){for(e=0;e<t.cleanups.length;e++)t.cleanups[e]();t.cleanups=null}t.state=0,t.context=null}function T(t){throw t}const B=Symbol("fallback");function j(t){for(let e=0;e<t.length;e++)t[e]()}function z(t,n,r={}){let s=[],i=[],l=[],u=0,a=n.length>1?[]:null;var c;return c=()=>j(l),null===o||(null===o.cleanups?o.cleanups=[c]:o.cleanups.push(c)),()=>{let o,c,h=t()||[];return h[e],b((()=>{let t,e,n,g,v,p,m,_,y,w=h.length;if(0===w)0!==u&&(j(l),l=[],s=[],i=[],u=0,a&&(a=[])),r.fallback&&(s=[B],i[0]=d((t=>(l[0]=t,r.fallback()))),u=1);else if(0===u){for(i=new Array(w),c=0;c<w;c++)s[c]=h[c],i[c]=d(f);u=w}else{for(n=new Array(w),g=new Array(w),a&&(v=new Array(w)),p=0,m=Math.min(u,w);p<m&&s[p]===h[p];p++);for(m=u-1,_=w-1;m>=p&&_>=p&&s[m]===h[_];m--,_--)n[_]=i[m],g[_]=l[m],a&&(v[_]=a[m]);for(t=new Map,e=new Array(_+1),c=_;c>=p;c--)y=h[c],o=t.get(y),e[c]=void 0===o?-1:o,t.set(y,c);for(o=p;o<=m;o++)y=s[o],c=t.get(y),void 0!==c&&-1!==c?(n[c]=i[o],g[c]=l[o],a&&(v[c]=a[o]),c=e[c],t.set(y,c)):l[o]();for(c=p;c<w;c++)c in n?(i[c]=n[c],l[c]=g[c],a&&(a[c]=v[c],a[c](c))):i[c]=d(f);i=i.slice(0,u=w),s=h.slice(0)}return i}));function f(t){if(l[c]=t,a){const[t,e]=g(c);return a[c]=e,n(h[c],t)}return n(h[c])}}}function X(t,e){return b((()=>t(e||{})))}function Y(t){const e="fallback"in t&&{fallback:()=>t.fallback};return _(z((()=>t.each),t.children,e||void 0))}function F(t){let e=!1;const n=_((()=>t.when),void 0,{equals:(t,n)=>e?t===n:!t==!n});return _((()=>{const r=n();if(r){const n=t.children;return(e="function"==typeof n&&n.length>0)?b((()=>n(r))):n}return t.fallback}))}function H(t,e,n){const r=document.createElement("template");r.innerHTML=t;let s=r.content.firstChild;return n&&(s=s.firstChild),s}function O(t,e,n={}){const r=t.style,s="string"==typeof n;if(null==e&&s||"string"==typeof e)return r.cssText=e;let i,o;for(o in s&&(r.cssText=void 0,n={}),e||(e={}),n)null==e[o]&&r.removeProperty(o),delete n[o];for(o in e)i=e[o],i!==n[o]&&(r.setProperty(o,i),n[o]=i);return n}function V(t,e,n,r){if(void 0===n||r||(r=[]),"function"!=typeof e)return D(t,e,r,n);p((r=>D(t,e(),r,n)),r)}function D(e,n,r,s,i){for(t.context&&!r&&(r=[...e.childNodes]);"function"==typeof r;)r=r();if(n===r)return r;const o=typeof n,l=void 0!==s;if(e=l&&r[0]&&r[0].parentNode||e,"string"===o||"number"===o){if(t.context)return r;if("number"===o&&(n=n.toString()),l){let t=r[0];t&&3===t.nodeType?t.data=n:t=document.createTextNode(n),r=I(e,r,s,t)}else r=""!==r&&"string"==typeof r?e.firstChild.data=n:e.textContent=n}else if(null==n||"boolean"===o){if(t.context)return r;r=I(e,r,s)}else{if("function"===o)return p((()=>{let t=n();for(;"function"==typeof t;)t=t();r=D(e,t,r,s)})),()=>r;if(Array.isArray(n)){const o=[];if(R(o,n,i))return p((()=>r=D(e,o,r,s,!0))),()=>r;if(t.context)for(let t=0;t<o.length;t++)if(o[t].parentNode)return r=o;if(0===o.length){if(r=I(e,r,s),l)return r}else Array.isArray(r)?0===r.length?G(e,o,s):function(t,e,n){let r=n.length,s=e.length,i=r,o=0,l=0,u=e[s-1].nextSibling,a=null;for(;o<s||l<i;)if(e[o]!==n[l]){for(;e[s-1]===n[i-1];)s--,i--;if(s===o){const e=i<r?l?n[l-1].nextSibling:n[i-l]:u;for(;l<i;)t.insertBefore(n[l++],e)}else if(i===l)for(;o<s;)a&&a.has(e[o])||e[o].remove(),o++;else if(e[o]===n[i-1]&&n[l]===e[s-1]){const r=e[--s].nextSibling;t.insertBefore(n[l++],e[o++].nextSibling),t.insertBefore(n[--i],r),e[s]=n[i]}else{if(!a){a=new Map;let t=l;for(;t<i;)a.set(n[t],t++)}const r=a.get(e[o]);if(null!=r)if(l<r&&r<i){let u,c=o,h=1;for(;++c<s&&c<i&&null!=(u=a.get(e[c]))&&u===r+h;)h++;if(h>r-l){const s=e[o];for(;l<r;)t.insertBefore(n[l++],s)}else t.replaceChild(n[l++],e[o++])}else o++;else e[o++].remove()}}else o++,l++}(e,r,o):(r&&I(e),G(e,o));r=o}else if(n instanceof Node){if(t.context&&n.parentNode)return r=l?[n]:n;if(Array.isArray(r)){if(l)return r=I(e,r,s,n);I(e,r,null,n)}else null!=r&&""!==r&&e.firstChild?e.replaceChild(n,e.firstChild):e.appendChild(n);r=n}}return r}function R(t,e,n){let r=!1;for(let s=0,i=e.length;s<i;s++){let i,o=e[s];if(o instanceof Node)t.push(o);else if(null==o||!0===o||!1===o);else if(Array.isArray(o))r=R(t,o)||r;else if("string"==(i=typeof o))t.push(document.createTextNode(o));else if("function"===i)if(n){for(;"function"==typeof o;)o=o();r=R(t,Array.isArray(o)?o:[o])||r}else t.push(o),r=!0;else t.push(document.createTextNode(o.toString()))}return r}function G(t,e,n){for(let r=0,s=e.length;r<s;r++)t.insertBefore(e[r],n)}function I(t,e,n,r){if(void 0===n)return t.textContent="";const s=r||document.createTextNode("");if(e.length){let r=!1;for(let i=e.length-1;i>=0;i--){const o=e[i];if(s!==o){const e=o.parentNode===t;r||i?e&&o.remove():e?t.replaceChild(s,o):t.insertBefore(s,n)}else r=!0}}else t.insertBefore(s,n);return[s]}class J{static from_angle=t=>new J(Math.cos(t),Math.sin(t));static make=(t,e)=>new J(t,e);static get unit(){return new J(1,1)}static get zero(){return new J(0,0)}get vs(){return[this.x,this.y]}get mul_inverse(){return new J(1/this.x,1/this.y)}get inverse(){return new J(-this.x,-this.y)}get half(){return new J(this.x/2,this.y/2)}get length_squared(){return this.x*this.x+this.y*this.y}get length(){return Math.sqrt(this.length_squared)}get normalize(){return 0===this.length?J.zero:this.scale(1/this.length)}get perpendicular(){return new J(-this.y,this.x)}get clone(){return new J(this.x,this.y)}get angle(){return Math.atan2(this.y,this.x)}constructor(t,e){this.x=t,this.y=e}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}project_to(t){let e=t.length_squared,n=this.dot(t);return J.make(n*t.x/e,n*t.y/e)}distance(t){return this.sub(t).length}addy(t){return J.make(this.x,this.y+t)}add_angle(t){return J.from_angle(this.angle+t)}scale(t){let{clone:e}=this;return e.scale_in(t)}scale_in(t){return this.x*=t,this.y*=t,this}add(t){let{clone:e}=this;return e.add_in(t)}add_in(t){return this.x+=t.x,this.y+=t.y,this}sub(t){let{clone:e}=this;return e.sub_in(t)}sub_in(t){return this.x-=t.x,this.y-=t.y,this}mul(t){let{clone:e}=this;return e.mul_in(t)}mul_in(t){return this.x*=t.x,this.y*=t.y,this}div(t){let{clone:e}=this;return e.div_in(t)}div_in(t){return this.x/=t.x,this.y/=t.y,this}set_in(t,e=this.y){return this.x=t,this.y=e,this}}function K(t,e){if("function"==typeof e)return t[1](e);t[1]((t=>e))}function Q(t){return Array.isArray(t)?t[0]():t()}class U{static make=(t,e,n)=>new U(t,e,n);get move(){return J.make(...this.drag.move).add(this.decay)}get translate(){return J.make(...this.drag.move).sub(this.start)}get drop(){return this.drag.drop}constructor(t,e,n){this.drag=t,this.orig=e,this.target=n,this.start=J.make(...t.start),this.decay=e.sub(this.start)}}function W(t){let e={};return t.replace(".","").split(";").forEach((t=>{t.split(",").forEach((t=>{let[n,r]=t.trim().split(" = ");e[n]||=[],e[n].push(r)}))})),e}var Z=new class{constructor(){this.session=pl.create()}consult(t){let{session:e}=this;return new Promise(((n,r)=>{e.consult("\n"+t+"\n",{success:n,error:r})}))}_query(t){let{session:e}=this;return new Promise(((n,r)=>{e.query(t,{success:n,error:r})}))}answer(){let{session:t}=this;return new Promise(((e,n)=>t.answer({success:n=>e(t.format_answer(n)),fail:e,error:n})))}one(t){return this._query(t).then((()=>this.answer().then((t=>"true."===t||(t?W(t):void 0)))))}async all(t){await this._query(t);let e="";for(let t=0;t<64;t++){let t=await this.answer();if("boolean"==typeof t){if(""===e)return t;break}if(!t)break;e+=t}return W(e)}};class tt{get atoms(){return this.m_atoms()}get selected_atoms(){return this.atoms.filter((t=>t.selected))}constructor(){y("file(a).\nfile(b).\nfile(c).\n",(t=>Z.consult(t)));let t=y("file(X).",(t=>Z.all(t))),e=_((()=>{let e=Q(t);return e?e.X.map((t=>`${"file"} ${t}`)):[]})),n=_((()=>e()));this.m_atoms=_(z(n,(t=>function(t,e){let[n,r]=e.split(" "),s=g(n),i=et(10,10),o=_((()=>[i.x,i.y,30,30])),l=g(!1);return{get key(){return atom_key},get name(){return Q(s)},get x(){return i.x},get y(){return i.y},on:(t,e)=>function(t,e,n,r,s,i){return t<=s&&s<=t+n&&e<=i&&i<=e+r}(...o(),t,e),in_rect:(t,e)=>function(t,e){let n=t[0],r=t[0]+t[2],s=t[1],i=t[1]+t[3],o=e[0],l=e[0]+e[2],u=e[1],a=e[1]+e[3];return!(o>r||l<n||u>i||a<s)}(o(),[t.x,t.y,e.x,e.y]),set selected(t){K(l,t)},get selected(){return Q(l)},pos:i}}(0,t))))}}function et(t,e){let n=g(t,{equals:!1}),r=g(e,{equals:!1}),s=_((()=>rt(Q(n),Q(r)))),i=_((()=>J.make(Q(n),Q(r))));return{get point(){return s()},get x(){return Q(n)},set x(t){K(n,t)},get y(){return Q(r)},set y(t){K(r,t)},set vs(t){w((()=>{K(n,t.x),K(r,t.y)}))},get vs(){return i()}}}const nt=(()=>{let t=0;return()=>++t})();function rt(t,e){return`${t} ${e} ${nt()}`}rt(0,0);class st{_wheel=0;_wheel0=0;get bounds(){return this._bounds||(this._bounds=this.$canvas.getBoundingClientRect()),this._bounds}get wheel(){return this._wheel}get drag(){if(this._drag?.move)return this._drag}get click(){if(!this._drag?.move&&this._drag?.drop)return this._drag.drop}get lclick(){if(0===this._drag?.button)return this.click}get rclick(){if(2===this._drag?.button)return this.click}get click_down(){if(!this._drag0&&this._drag&&!this._drag?.move&&!this._drag?.drop)return this._drag.start}get hover(){if(!this._drag)return this._hover}get drag_delta(){if(this._drag?.move)return[this._drag.move[0]-this._drag.start[0],this._drag.move[1]-this._drag.start[1]]}constructor(t){this.$canvas=t}eventPosition(t){let e=function(t){return void 0!==t.clientX&&void 0!==t.clientY?[t.clientX,t.clientY]:t.targetTouches?.[0]?[t.targetTouches[0].clientX,t.targetTouches[0].clientY]:void 0}(t),{bounds:n}=this;return e&&(e[0]-=n.left,e[1]-=n.top,e[0]*=1,e[1]*=1),e}disposes=[];dispose(){this.disposes.forEach((t=>t()))}init(){let{$canvas:t,disposes:e}=this;t.addEventListener("wheel",(t=>{this._wheel=Math.sign(t.deltaY)})),t.addEventListener("mousedown",(t=>{this._drag||(this._drag1={button:t.button,start:this.eventPosition(t)})})),t.addEventListener("mousemove",(t=>{this._drag?this._drag.r_move=this.eventPosition(t):this._hover=this.eventPosition(t)})),t.addEventListener("contextmenu",(t=>{t.preventDefault(),this._drag||(this._drag1={button:t.button,start:this.eventPosition(t)})}));let n=t=>{this._drag&&(this._drag.drop=this.eventPosition(t),this._drop0=this._drag)};document.addEventListener("mouseup",n),e.push((()=>document.removeEventListener("mouseup",n)));const r=()=>{this._bounds=void 0};return window.addEventListener("resize",r),document.addEventListener("scroll",r),e.push((()=>window.removeEventListener("resize",r))),e.push((()=>document.removeEventListener("scroll",r))),this}update(t,e){this._wheel0===this._wheel?this._wheel=0:this._wheel0=this._wheel,this._drag&&(this._drag.move0=this._drag.move,void 0!==this._drag.r_move&&(this._drag.move||function(t,e){let n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)>3}(this._drag.r_move,this._drag.start))&&(this._drag.move=this._drag.r_move),this._drop0?this._drop0=void 0:this._drag.drop&&(this._drag1=void 0)),this._drag0=this._drag,this._drag1!==this._drag&&(this._drag=this._drag1)}}const it=H("<vpro></vpro>"),ot=H("<grid></grid>"),lt=H('<div class="selection"></div>'),ut=H("<atom></atom>"),at=()=>{let t=new tt;return(()=>{const e=it.cloneNode(!0);return V(e,X(ct,{game:t,get atoms(){return t.atoms}})),e})()},ct=t=>{let e,n=g(),r=g(),s=_((()=>Q(r))),i=_((()=>Q(n))),o=g([16,16],{equals:!1}),l=_((()=>Q(o)));var u;u=()=>{let s=new st(e).init();!function(t){let e,n,r=1e3/60,s=r;e=requestAnimationFrame((function i(o){let l=n?o-n:r;l=Math.min(33.333333333333336,Math.max(16.666666666666668,l)),t(l,s),s=l,n=o,e=requestAnimationFrame(i)}))}(((e,i)=>{s.update(e,i),K(o,[e,i]);let{drag:l}=s;if(l&&!l.move0){let e=t.atoms.find((t=>t.on(...l.start)));e?K(r,new U(l,e.pos.vs,e)):K(n,new U(l,J.make(...l.start),et(0,0)))}}))},m((()=>b(u))),m((()=>{let t=s();t&&m(x(l,((e,n)=>{t.target.pos.vs=t.move,t.drop&&K(r,void 0)})))})),m((()=>{let e=i();e&&m(x(l,((r,s)=>{e.target.vs=e.translate.clone,e.drop&&(t.atoms.forEach((t=>t.selected=!1)),t.atoms.filter((t=>t.in_rect(e.start,e.target.vs))).forEach((t=>t.selected=!0)),K(n,void 0))})))}));return(()=>{const n=ot.cloneNode(!0);return"function"==typeof e?e(n):e=n,V(n,X(Y,{get each(){return t.atoms},children:t=>X(ht,{atom:t})}),null),V(n,X(F,{get when(){return i()},children:t=>(()=>{const e=lt.cloneNode(!0);return p((n=>{return O(e,(r=t.start,s=t.target.x,i=t.target.y,{transform:`translate(${r.x}px, ${r.y}px)`,width:`${s}px`,height:`${i}px`}),n);var r,s,i})),e})()}),null),n})()},ht=t=>(()=>{const e=ut.cloneNode(!0);return V(e,(()=>t.atom.name)),p((n=>{const r=["handle",t.atom.selected?"selected":""].join(" "),s={transform:`translate(${t.atom.x}px, ${t.atom.y}px)`};var i,o;return r!==n._v$&&(i=e,null==(o=n._v$=r)?i.removeAttribute("class"):i.className=o),n._v$2=O(e,s,n._v$2),n}),{_v$:void 0,_v$2:void 0}),e})();return function(t){!function(t,e,n){let r;d((s=>{r=s,e===document?t():V(e,t(),e.firstChild?null:void 0,n)}))}(at,t)}}();
