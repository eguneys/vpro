var VPro=function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(e),o=n(t);const s={};const l={equals:(e,t)=>e===t};let i=null,u=$;const c={},f={owned:null,cleanups:null,context:null,owner:null};var a=null;let h,d=null,p=null,v=null,g=null,m=0;function b(e,t){t=t?Object.assign({},l,t):l;const n={value:e,observers:null,observerSlots:null,pending:c,comparator:t.equals||void 0};return[k.bind(n),e=>("function"==typeof e&&(e=e(n.pending!==c?n.pending:n.value)),N(n,e))]}function y(e,t,n){j(q(e,t,!0,1))}function w(e,t,n){j(q(e,t,!1,1))}function x(e,t,n){u=B;const r=q(e,t,!1,1);r.user=!0,g?g.push(r):j(r)}function _(e,t,n){n=n?Object.assign({},l,n):l;const r=q(e,t,!0,0);return r.pending=c,r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,j(r),k.bind(r)}function A(e,t,n){2===arguments.length?"object"==typeof t&&(n=t,t=e,e=!0):1===arguments.length&&(t=e,e=!0),n||(n={});const r=new Set,[o,l]=b(n.initialValue),[i,u]=b(void 0,{equals:!1}),[c,f]=b(!1),[a,p]=b();let v,g=null,m=null,w=null,x=!1,A="initialValue"in n,P="function"==typeof e&&_(e);function k(e,t,r,o){return g===e&&(g=null,A=!0,m&&(e===m||t===m)&&n.onHydrated&&queueMicrotask((()=>n.onHydrated(o,{value:t}))),m=null,p(v=r),N(t)),t}function N(e){S((()=>{l((()=>e)),f(!1);for(const e of r.keys())e.decrement();r.clear()}))}function j(){const e=h,t=o();if(v)throw v;return d&&!d.user&&e&&y((()=>{i(),g&&(e.resolved||r.has(e)||(e.increment(),r.add(e)))})),t}function q(n=!0){if(n&&x)return;x=!1,p(v=void 0);const r=P?P():e;if(null==r||!1===r)return void k(g,C(o));const s=m||C((()=>t(r,{value:o(),refetching:n})));return"object"==typeof s&&"then"in s?(g=s,x=!0,queueMicrotask((()=>x=!1)),S((()=>{f(!0),u()})),s.then((e=>k(s,e,void 0,r)),(e=>k(s,e,e)))):(k(g,s),s)}return s.context&&(w=`${s.context.id}${s.context.count++}`,s.load&&(m=s.load(w))),Object.defineProperties(j,{loading:{get:()=>c()},error:{get:()=>a()},latest:{get(){if(!A)return j();if(v)throw v;return o()}}}),P?y((()=>q(!1))):q(!1),[j,{refetch:q,mutate:l}]}function S(e){if(p)return e();let t;const n=p=[];try{t=e()}finally{p=null}return T((()=>{for(let e=0;e<n.length;e+=1){const t=n[e];if(t.pending!==c){const e=t.pending;t.pending=c,N(t,e)}}}),!1),t}function C(e){let t,n=d;return d=null,t=e(),d=n,t}function P(e,t,n){const r=Array.isArray(e);let o,s=n&&n.defer;return n=>{let l;if(r){l=Array(e.length);for(let t=0;t<e.length;t++)l[t]=e[t]()}else l=e();if(s)return void(s=!1);const i=C((()=>t(l,o,n)));return o=l,i}}function k(){if(this.sources&&this.state){const e=v;v=null,1===this.state?j(this):O(this),v=e}if(d){const e=this.observers?this.observers.length:0;d.sources?(d.sources.push(this),d.sourceSlots.push(e)):(d.sources=[this],d.sourceSlots=[e]),this.observers?(this.observers.push(d),this.observerSlots.push(d.sources.length-1)):(this.observers=[d],this.observerSlots=[d.sources.length-1])}return this.value}function N(e,t,n){if(p)return e.pending===c&&p.push(e),e.pending=t,t;if(e.comparator&&e.comparator(e.value,t))return t;let r=!1;return e.value=t,e.observers&&e.observers.length&&T((()=>{for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];r,n.state||(n.pure?v.push(n):g.push(n),n.observers&&V(n)),n.state=1}if(v.length>1e6)throw v=[],new Error}),!1),t}function j(e){if(!e.fn)return;M(e);const t=a,n=d,r=m;d=a=e,function(e,t,n){let r;try{r=e.fn(t)}catch(e){X(e)}(!e.updatedAt||e.updatedAt<=n)&&(e.observers&&e.observers.length?N(e,r):e.value=r,e.updatedAt=n)}(e,e.value,r),d=n,a=t}function q(e,t,n,r=1,o){const s={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:a,context:null,pure:n};return null===a||a!==f&&(a.owned?a.owned.push(s):a.owned=[s]),s}function E(e){if(0===e.state)return;if(2===e.state)return O(e);if(e.suspense&&C(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<m);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(1===(e=t[n]).state)j(e);else if(2===e.state){const n=v;v=null,O(e,t[0]),v=n}}function T(e,t){if(v)return e();let n=!1;t||(v=[]),g?n=!0:g=[],m++;try{const t=e();return function(e){v&&($(v),v=null);if(e)return;g.length?S((()=>{u(g),g=null})):g=null}(n),t}catch(e){X(e)}finally{v=null,n||(g=null)}}function $(e){for(let t=0;t<e.length;t++)E(e[t])}function B(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:E(r)}var r;s.context&&(s.context=r);const o=e.length;for(t=0;t<n;t++)E(e[t]);for(t=o;t<e.length;t++)E(e[t])}function O(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];r.sources&&(1===r.state?r!==t&&E(r):2===r.state&&O(r,t))}}function V(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=2,n.pure?v.push(n):g.push(n),n.observers&&V(n))}}function M(e){let t;if(e.sources)for(;e.sources.length;){const t=e.sources.pop(),n=e.sourceSlots.pop(),r=t.observers;if(r&&r.length){const e=r.pop(),o=t.observerSlots.pop();n<r.length&&(e.sourceSlots[o]=n,r[n]=e,t.observerSlots[n]=o)}}if(e.owned){for(t=0;t<e.owned.length;t++)M(e.owned[t]);e.owned=null}if(e.cleanups){for(t=0;t<e.cleanups.length;t++)e.cleanups[t]();e.cleanups=null}e.state=0,e.context=null}function X(e){const t=i&&L(a,i);if(!t)throw e;t.forEach((t=>t(e)))}function L(e,t){return e?e.context&&void 0!==e.context[t]?e.context[t]:L(e.owner,t):void 0}const D="_$DX_DELEGATE";function H(e,t,n){let r;return function(e,t){const n=d,r=a,o=0===e.length?f:{owned:null,cleanups:null,context:null,owner:t||r};a=o,d=null;try{T((()=>e((()=>M(o)))),!0)}finally{d=n,a=r}}((o=>{r=o,t===document?e():function(e,t,n,r){void 0===n||r||(r=[]);if("function"!=typeof t)return G(e,t,r,n);w((r=>G(e,t(),r,n)),r)}(t,e(),t.firstChild?null:void 0,n)})),()=>{r(),t.textContent=""}}function I(e,t,n){const r=document.createElement("template");r.innerHTML=e;let o=r.content.firstChild;return n&&(o=o.firstChild),o}function R(e,t=window.document){const n=t[D]||(t[D]=new Set);for(let r=0,o=e.length;r<o;r++){const o=e[r];n.has(o)||(n.add(o),t.addEventListener(o,F))}}function F(e){const t=`$$${e.type}`;let n=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==n&&Object.defineProperty(e,"target",{configurable:!0,value:n}),Object.defineProperty(e,"currentTarget",{configurable:!0,get:()=>n||document}),s.registry&&!s.done&&(s.done=!0,document.querySelectorAll("[id^=pl-]").forEach((e=>e.remove())));null!==n;){const r=n[t];if(r&&!n.disabled){const o=n[`${t}Data`];if(void 0!==o?r(o,e):r(e),e.cancelBubble)return}n=n.host&&n.host!==n&&n.host instanceof Node?n.host:n.parentNode}}function G(e,t,n,r,o){for(s.context&&!n&&(n=[...e.childNodes]);"function"==typeof n;)n=n();if(t===n)return n;const l=typeof t,i=void 0!==r;if(e=i&&n[0]&&n[0].parentNode||e,"string"===l||"number"===l){if(s.context)return n;if("number"===l&&(t=t.toString()),i){let o=n[0];o&&3===o.nodeType?o.data=t:o=document.createTextNode(t),n=K(e,n,r,o)}else n=""!==n&&"string"==typeof n?e.firstChild.data=t:e.textContent=t}else if(null==t||"boolean"===l){if(s.context)return n;n=K(e,n,r)}else{if("function"===l)return w((()=>{let o=t();for(;"function"==typeof o;)o=o();n=G(e,o,n,r)})),()=>n;if(Array.isArray(t)){const l=[];if(z(l,t,o))return w((()=>n=G(e,l,n,r,!0))),()=>n;if(s.context)for(let e=0;e<l.length;e++)if(l[e].parentNode)return n=l;if(0===l.length){if(n=K(e,n,r),i)return n}else Array.isArray(n)?0===n.length?J(e,l,r):function(e,t,n){let r=n.length,o=t.length,s=r,l=0,i=0,u=t[o-1].nextSibling,c=null;for(;l<o||i<s;)if(t[l]!==n[i]){for(;t[o-1]===n[s-1];)o--,s--;if(o===l){const t=s<r?i?n[i-1].nextSibling:n[s-i]:u;for(;i<s;)e.insertBefore(n[i++],t)}else if(s===i)for(;l<o;)c&&c.has(t[l])||t[l].remove(),l++;else if(t[l]===n[s-1]&&n[i]===t[o-1]){const r=t[--o].nextSibling;e.insertBefore(n[i++],t[l++].nextSibling),e.insertBefore(n[--s],r),t[o]=n[s]}else{if(!c){c=new Map;let e=i;for(;e<s;)c.set(n[e],e++)}const r=c.get(t[l]);if(null!=r)if(i<r&&r<s){let u,f=l,a=1;for(;++f<o&&f<s&&null!=(u=c.get(t[f]))&&u===r+a;)a++;if(a>r-i){const o=t[l];for(;i<r;)e.insertBefore(n[i++],o)}else e.replaceChild(n[i++],t[l++])}else l++;else t[l++].remove()}}else l++,i++}(e,n,l):(n&&K(e),J(e,l));n=l}else if(t instanceof Node){if(s.context&&t.parentNode)return n=i?[t]:t;if(Array.isArray(n)){if(i)return n=K(e,n,r,t);K(e,n,null,t)}else null!=n&&""!==n&&e.firstChild?e.replaceChild(t,e.firstChild):e.appendChild(t);n=t}}return n}function z(e,t,n){let r=!1;for(let o=0,s=t.length;o<s;o++){let s,l=t[o];if(l instanceof Node)e.push(l);else if(null==l||!0===l||!1===l);else if(Array.isArray(l))r=z(e,l)||r;else if("string"==(s=typeof l))e.push(document.createTextNode(l));else if("function"===s)if(n){for(;"function"==typeof l;)l=l();r=z(e,Array.isArray(l)?l:[l])||r}else e.push(l),r=!0;else e.push(document.createTextNode(l.toString()))}return r}function J(e,t,n){for(let r=0,o=t.length;r<o;r++)e.insertBefore(t[r],n)}function K(e,t,n,r){if(void 0===n)return e.textContent="";const o=r||document.createTextNode("");if(t.length){let r=!1;for(let s=t.length-1;s>=0;s--){const l=t[s];if(o!==l){const t=l.parentNode===e;r||s?t&&l.remove():t?e.replaceChild(o,l):e.insertBefore(o,n)}else r=!0}}else e.insertBefore(o,n);return[o]}function Q(e,t){if("function"==typeof t)return e[1](t);e[1]((e=>t))}function U(e){return Array.isArray(e)?e[0]():e()}function W(e){let t={};return e.replace(".","").replace(/;$/,"").split(";").forEach((e=>{e.split(",").forEach((e=>{let[n,r]=e.trim().split(" = ");t[n]||=[],t[n].push(r)}))})),t}var Y=new class{constructor(){this.session=pl.create()}consult(e){this.session=pl.create();let{session:t}=this;return new Promise(((n,r)=>{t.consult("\n"+e+"\n",{success:()=>n(e),error:r})}))}_query(e){let{session:t}=this;return new Promise(((n,r)=>{t.query(e,{success:n,limit:()=>r("limit"),error:r})}))}answer(){let{session:e}=this;return new Promise(((t,n)=>e.answer({success:n=>t(e.format_answer(n)),limit:()=>n("limit"),fail:t,error:n})))}one(e){return this._query(e).then((()=>this.answer().then((e=>"true."===e||(e?W(e):void 0)))))}async all(e){await this._query(e);let t="";for(let e=0;e<64;e++){let e=await this.answer();if("boolean"==typeof e){if(""===t)return e;break}if(!e)break;t+=e}return W(t)}};!function(){let e=Promise.resolve()}(),R(["click"]);const Z=(e=>{let t={get:t=>e.getItem(t),set:(t,n)=>e.setItem(t,n),remove:t=>e.removeItem(t),make:e=>({get:()=>t.get(e),set:n=>t.set(e,n),remove:()=>t.remove(e)})};return t})(window.localStorage).make("vpro-chess.pl"),ee="\n% V Aid Prolog Language\n\n:- dynamic(white/1).\n:- dynamic(orange/1).\n:- dynamic(black/1).\n\ncolor(white, Pos) :- white(Pos).\ncolor(orange, Pos) :- orange(Pos).\ncolor(black, Pos) :- black(Pos).\n";function te(e,t,n){return e.map(((e,r)=>n([e,t[r]])))}function ne(e){return"line"===e?.id?e.args[0].value:e?.args?.flatMap(ne)||[]}class re{get content(){return U(this._source)}constructor(){this._source=b(Z.get()||ee),this.r_consult=A(this._source[0],se((e=>Y.consult(e)))),this.r_whites=A("color(Color, X).",se((e=>Y.all(e))));let e=_((()=>{let e=U(this.r_whites);return e?te(e.Color,e.X.map((e=>e.split("-").join(""))),(e=>e.join("@"))):[]}));this.r_pieces=A("piece(Color-Role-X).",se((e=>Y.all(e))));let t=_((()=>{let e=U(this.r_pieces);return e?te(te(e.Color,e.Role,(e=>e.join(""))),e.X.map((e=>e.split("-").join(""))),(e=>e.join("@"))):[]}));var n;x((()=>{let e=t();this.oboard&&(console.log(e),this.oboard.pieses=e)})),x((()=>{let t=e();this.oboard&&(this.oboard.squares=t)})),n=e=>{console.log("error",e),this.ovim&&(this.ovim.prompt=e)},i||(i=Symbol("error")),null===a||(null===a.context?a.context={[i]:[n]}:a.context[i]?a.context[i].push(n):a.context[i]=[n]),x(P(this.r_consult[0],(()=>{this.r_consult[0].error||(oe(this.r_whites),oe(this.r_pieces))}))),x(P((()=>this.r_whites[0].error),(e=>{this.ovim&&(this.ovim.prompt=e?`Error: ${e}`:"")}))),x(P((()=>this.r_consult[0].error),(e=>{let t=ne(e);this.ovim&&(this.ovim.clear_lines(),t.forEach((e=>{this.ovim.line_klass(e-2,"error")})))})))}on_command(e,t){switch(e){case":copy":navigator.clipboard.writeText(t);break;case":w":Q(this._source,t),Z.set(t);break;case":clear":Z.remove(),Q(this._source,ee),this.ovim.content=ee;break;default:Q(this._source,t)}}}function oe(e){let[t,{refetch:n}]=e;n()}let se=function(){let e=Promise.resolve();return t=>n=>new Promise(((r,o)=>{e=e.then((()=>t(n).then(r).catch(o)))}))}();const le=I('<div class="vpro"><div class="v-code"></div><div class="v-board"></div></div>'),ie=()=>{let e,t,n=new re;var s;return s=()=>{n.ovim=r.default(e,{content:n.content,on_command(e,t){n.on_command(e,t)}}),n.oboard=o.default(t)},x((()=>C(s))),(()=>{const n=le.cloneNode(!0),r=n.firstChild,o=r.nextSibling;"function"==typeof e?e(r):e=r;return"function"==typeof t?t(o):t=o,n})()};return R(["click","keyup"]),function(e){H(ie,e)}}(OVim,VChessboard);
